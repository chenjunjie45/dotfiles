"use strict";var Io=Object.create;var le=Object.defineProperty;var vo=Object.getOwnPropertyDescriptor;var Fo=Object.getOwnPropertyNames;var Eo=Object.getPrototypeOf,Co=Object.prototype.hasOwnProperty;var S=(e,t)=>()=>(t||e((t={exports:{}}).exports,t),t.exports),st=(e,t)=>{for(var n in t)le(e,n,{get:t[n],enumerable:!0})},it=(e,t,n,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let r of Fo(t))!Co.call(e,r)&&r!==n&&le(e,r,{get:()=>t[r],enumerable:!(o=vo(t,r))||o.enumerable});return e};var k=(e,t,n)=>(n=e!=null?Io(Eo(e)):{},it(t||!e||!e.__esModule?le(n,"default",{value:e,enumerable:!0}):n,e)),Ho=e=>it(le({},"__esModule",{value:!0}),e);var ft=S((ks,mt)=>{mt.exports=dt;dt.sync=Ao;var lt=require("fs");function Po(e,t){var n=t.pathExt!==void 0?t.pathExt:process.env.PATHEXT;if(!n||(n=n.split(";"),n.indexOf("")!==-1))return!0;for(var o=0;o<n.length;o++){var r=n[o].toLowerCase();if(r&&e.substr(-r.length).toLowerCase()===r)return!0}return!1}function ut(e,t,n){return!e.isSymbolicLink()&&!e.isFile()?!1:Po(t,n)}function dt(e,t,n){lt.stat(e,function(o,r){n(o,o?!1:ut(r,e,t))})}function Ao(e,t){return ut(lt.statSync(e),e,t)}});var gt=S((Rs,St)=>{St.exports=ht;ht.sync=To;var pt=require("fs");function ht(e,t,n){pt.stat(e,function(o,r){n(o,o?!1:yt(r,t))})}function To(e,t){return yt(pt.statSync(e),t)}function yt(e,t){return e.isFile()&&Do(e,t)}function Do(e,t){var n=e.mode,o=e.uid,r=e.gid,i=t.uid!==void 0?t.uid:process.getuid&&process.getuid(),a=t.gid!==void 0?t.gid:process.getgid&&process.getgid(),d=parseInt("100",8),p=parseInt("010",8),h=parseInt("001",8),x=d|p,g=n&h||n&p&&r===a||n&d&&o===i||n&x&&i===0;return g}});var xt=S((Os,wt)=>{var Gs=require("fs"),ue;process.platform==="win32"||global.TESTING_WINDOWS?ue=ft():ue=gt();wt.exports=De;De.sync=No;function De(e,t,n){if(typeof t=="function"&&(n=t,t={}),!n){if(typeof Promise!="function")throw new TypeError("callback not provided");return new Promise(function(o,r){De(e,t||{},function(i,a){i?r(i):o(a)})})}ue(e,t||{},function(o,r){o&&(o.code==="EACCES"||t&&t.ignoreErrors)&&(o=null,r=!1),n(o,r)})}function No(e,t){try{return ue.sync(e,t||{})}catch(n){if(t&&t.ignoreErrors||n.code==="EACCES")return!1;throw n}}});var Ht=S(($s,Ct)=>{var _=process.platform==="win32"||process.env.OSTYPE==="cygwin"||process.env.OSTYPE==="msys",bt=require("path"),ko=_?";":":",It=xt(),vt=e=>Object.assign(new Error(`not found: ${e}`),{code:"ENOENT"}),Ft=(e,t)=>{let n=t.colon||ko,o=e.match(/\//)||_&&e.match(/\\/)?[""]:[..._?[process.cwd()]:[],...(t.path||process.env.PATH||"").split(n)],r=_?t.pathExt||process.env.PATHEXT||".EXE;.CMD;.BAT;.COM":"",i=_?r.split(n):[""];return _&&e.indexOf(".")!==-1&&i[0]!==""&&i.unshift(""),{pathEnv:o,pathExt:i,pathExtExe:r}},Et=(e,t,n)=>{typeof t=="function"&&(n=t,t={}),t||(t={});let{pathEnv:o,pathExt:r,pathExtExe:i}=Ft(e,t),a=[],d=h=>new Promise((x,g)=>{if(h===o.length)return t.all&&a.length?x(a):g(vt(e));let v=o[h],b=/^".*"$/.test(v)?v.slice(1,-1):v,F=bt.join(b,e),E=!b&&/^\.[\\\/]/.test(e)?e.slice(0,2)+F:F;x(p(E,h,0))}),p=(h,x,g)=>new Promise((v,b)=>{if(g===r.length)return v(d(x+1));let F=r[g];It(h+F,{pathExt:i},(E,A)=>{if(!E&&A)if(t.all)a.push(h+F);else return v(h+F);return v(p(h,x,g+1))})});return n?d(0).then(h=>n(null,h),n):d(0)},Ro=(e,t)=>{t=t||{};let{pathEnv:n,pathExt:o,pathExtExe:r}=Ft(e,t),i=[];for(let a=0;a<n.length;a++){let d=n[a],p=/^".*"$/.test(d)?d.slice(1,-1):d,h=bt.join(p,e),x=!p&&/^\.[\\\/]/.test(e)?e.slice(0,2)+h:h;for(let g=0;g<o.length;g++){let v=x+o[g];try{if(It.sync(v,{pathExt:r}))if(t.all)i.push(v);else return v}catch{}}}if(t.all&&i.length)return i;if(t.nothrow)return null;throw vt(e)};Ct.exports=Et;Et.sync=Ro});var ke=S((Ls,Ne)=>{"use strict";var Pt=(e={})=>{let t=e.env||process.env;return(e.platform||process.platform)!=="win32"?"PATH":Object.keys(t).reverse().find(o=>o.toUpperCase()==="PATH")||"Path"};Ne.exports=Pt;Ne.exports.default=Pt});var Nt=S((Bs,Dt)=>{"use strict";var At=require("path"),Go=Ht(),Oo=ke();function Tt(e,t){let n=e.options.env||process.env,o=process.cwd(),r=e.options.cwd!=null,i=r&&process.chdir!==void 0&&!process.chdir.disabled;if(i)try{process.chdir(e.options.cwd)}catch{}let a;try{a=Go.sync(e.command,{path:n[Oo({env:n})],pathExt:t?At.delimiter:void 0})}catch{}finally{i&&process.chdir(o)}return a&&(a=At.resolve(r?e.options.cwd:"",a)),a}function $o(e){return Tt(e)||Tt(e,!0)}Dt.exports=$o});var kt=S((qs,Ge)=>{"use strict";var Re=/([()\][%!^"`<>&|;, *?])/g;function Lo(e){return e=e.replace(Re,"^$1"),e}function Bo(e,t){return e=`${e}`,e=e.replace(/(\\*)"/g,'$1$1\\"'),e=e.replace(/(\\*)$/,"$1$1"),e=`"${e}"`,e=e.replace(Re,"^$1"),t&&(e=e.replace(Re,"^$1")),e}Ge.exports.command=Lo;Ge.exports.argument=Bo});var Gt=S((Us,Rt)=>{"use strict";Rt.exports=/^#!(.*)/});var $t=S((_s,Ot)=>{"use strict";var qo=Gt();Ot.exports=(e="")=>{let t=e.match(qo);if(!t)return null;let[n,o]=t[0].replace(/#! ?/,"").split(" "),r=n.split("/").pop();return r==="env"?o:o?`${r} ${o}`:r}});var Bt=S((Ms,Lt)=>{"use strict";var Oe=require("fs"),Uo=$t();function _o(e){let n=Buffer.alloc(150),o;try{o=Oe.openSync(e,"r"),Oe.readSync(o,n,0,150,0),Oe.closeSync(o)}catch{}return Uo(n.toString())}Lt.exports=_o});var Mt=S((js,_t)=>{"use strict";var Mo=require("path"),qt=Nt(),Ut=kt(),jo=Bt(),Ko=process.platform==="win32",Xo=/\.(?:com|exe)$/i,Wo=/node_modules[\\/].bin[\\/][^\\/]+\.cmd$/i;function Vo(e){e.file=qt(e);let t=e.file&&jo(e.file);return t?(e.args.unshift(e.file),e.command=t,qt(e)):e.file}function zo(e){if(!Ko)return e;let t=Vo(e),n=!Xo.test(t);if(e.options.forceShell||n){let o=Wo.test(t);e.command=Mo.normalize(e.command),e.command=Ut.command(e.command),e.args=e.args.map(i=>Ut.argument(i,o));let r=[e.command].concat(e.args).join(" ");e.args=["/d","/s","/c",`"${r}"`],e.command=process.env.comspec||"cmd.exe",e.options.windowsVerbatimArguments=!0}return e}function Yo(e,t,n){t&&!Array.isArray(t)&&(n=t,t=null),t=t?t.slice(0):[],n=Object.assign({},n);let o={command:e,args:t,options:n,file:void 0,original:{command:e,args:t}};return n.shell?o:zo(o)}_t.exports=Yo});var Xt=S((Ks,Kt)=>{"use strict";var $e=process.platform==="win32";function Le(e,t){return Object.assign(new Error(`${t} ${e.command} ENOENT`),{code:"ENOENT",errno:"ENOENT",syscall:`${t} ${e.command}`,path:e.command,spawnargs:e.args})}function Jo(e,t){if(!$e)return;let n=e.emit;e.emit=function(o,r){if(o==="exit"){let i=jt(r,t,"spawn");if(i)return n.call(e,"error",i)}return n.apply(e,arguments)}}function jt(e,t){return $e&&e===1&&!t.file?Le(t.original,"spawn"):null}function Qo(e,t){return $e&&e===1&&!t.file?Le(t.original,"spawnSync"):null}Kt.exports={hookChildProcess:Jo,verifyENOENT:jt,verifyENOENTSync:Qo,notFoundError:Le}});var zt=S((Xs,M)=>{"use strict";var Wt=require("child_process"),Be=Mt(),qe=Xt();function Vt(e,t,n){let o=Be(e,t,n),r=Wt.spawn(o.command,o.args,o.options);return qe.hookChildProcess(r,o),r}function Zo(e,t,n){let o=Be(e,t,n),r=Wt.spawnSync(o.command,o.args,o.options);return r.error=r.error||qe.verifyENOENTSync(r.status,o),r}M.exports=Vt;M.exports.spawn=Vt;M.exports.sync=Zo;M.exports._parse=Be;M.exports._enoent=qe});var Jt=S((Ws,Yt)=>{"use strict";Yt.exports=e=>{let t=typeof e=="string"?`
`:10,n=typeof e=="string"?"\r":13;return e[e.length-1]===t&&(e=e.slice(0,e.length-1)),e[e.length-1]===n&&(e=e.slice(0,e.length-1)),e}});var en=S((Vs,ne)=>{"use strict";var te=require("path"),Qt=ke(),Zt=e=>{e={cwd:process.cwd(),path:process.env[Qt()],execPath:process.execPath,...e};let t,n=te.resolve(e.cwd),o=[];for(;t!==n;)o.push(te.join(n,"node_modules/.bin")),t=n,n=te.resolve(n,"..");let r=te.resolve(e.cwd,e.execPath,"..");return o.push(r),o.concat(e.path).join(te.delimiter)};ne.exports=Zt;ne.exports.default=Zt;ne.exports.env=e=>{e={env:process.env,...e};let t={...e.env},n=Qt({env:t});return e.path=t[n],t[n]=ne.exports(e),t}});var nn=S((zs,Ue)=>{"use strict";var tn=(e,t)=>{for(let n of Reflect.ownKeys(t))Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n));return e};Ue.exports=tn;Ue.exports.default=tn});var rn=S((Ys,me)=>{"use strict";var er=nn(),de=new WeakMap,on=(e,t={})=>{if(typeof e!="function")throw new TypeError("Expected a function");let n,o=0,r=e.displayName||e.name||"<anonymous>",i=function(...a){if(de.set(i,++o),o===1)n=e.apply(this,a),e=null;else if(t.throw===!0)throw new Error(`Function \`${r}\` can only be called once`);return n};return er(i,e),de.set(i,o),i};me.exports=on;me.exports.default=on;me.exports.callCount=e=>{if(!de.has(e))throw new Error(`The given function \`${e.name}\` is not wrapped by the \`onetime\` package`);return de.get(e)}});var sn=S(fe=>{"use strict";Object.defineProperty(fe,"__esModule",{value:!0});fe.SIGNALS=void 0;var tr=[{name:"SIGHUP",number:1,action:"terminate",description:"Terminal closed",standard:"posix"},{name:"SIGINT",number:2,action:"terminate",description:"User interruption with CTRL-C",standard:"ansi"},{name:"SIGQUIT",number:3,action:"core",description:"User interruption with CTRL-\\",standard:"posix"},{name:"SIGILL",number:4,action:"core",description:"Invalid machine instruction",standard:"ansi"},{name:"SIGTRAP",number:5,action:"core",description:"Debugger breakpoint",standard:"posix"},{name:"SIGABRT",number:6,action:"core",description:"Aborted",standard:"ansi"},{name:"SIGIOT",number:6,action:"core",description:"Aborted",standard:"bsd"},{name:"SIGBUS",number:7,action:"core",description:"Bus error due to misaligned, non-existing address or paging error",standard:"bsd"},{name:"SIGEMT",number:7,action:"terminate",description:"Command should be emulated but is not implemented",standard:"other"},{name:"SIGFPE",number:8,action:"core",description:"Floating point arithmetic error",standard:"ansi"},{name:"SIGKILL",number:9,action:"terminate",description:"Forced termination",standard:"posix",forced:!0},{name:"SIGUSR1",number:10,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGSEGV",number:11,action:"core",description:"Segmentation fault",standard:"ansi"},{name:"SIGUSR2",number:12,action:"terminate",description:"Application-specific signal",standard:"posix"},{name:"SIGPIPE",number:13,action:"terminate",description:"Broken pipe or socket",standard:"posix"},{name:"SIGALRM",number:14,action:"terminate",description:"Timeout or timer",standard:"posix"},{name:"SIGTERM",number:15,action:"terminate",description:"Termination",standard:"ansi"},{name:"SIGSTKFLT",number:16,action:"terminate",description:"Stack is empty or overflowed",standard:"other"},{name:"SIGCHLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"posix"},{name:"SIGCLD",number:17,action:"ignore",description:"Child process terminated, paused or unpaused",standard:"other"},{name:"SIGCONT",number:18,action:"unpause",description:"Unpaused",standard:"posix",forced:!0},{name:"SIGSTOP",number:19,action:"pause",description:"Paused",standard:"posix",forced:!0},{name:"SIGTSTP",number:20,action:"pause",description:'Paused using CTRL-Z or "suspend"',standard:"posix"},{name:"SIGTTIN",number:21,action:"pause",description:"Background process cannot read terminal input",standard:"posix"},{name:"SIGBREAK",number:21,action:"terminate",description:"User interruption with CTRL-BREAK",standard:"other"},{name:"SIGTTOU",number:22,action:"pause",description:"Background process cannot write to terminal output",standard:"posix"},{name:"SIGURG",number:23,action:"ignore",description:"Socket received out-of-band data",standard:"bsd"},{name:"SIGXCPU",number:24,action:"core",description:"Process timed out",standard:"bsd"},{name:"SIGXFSZ",number:25,action:"core",description:"File too big",standard:"bsd"},{name:"SIGVTALRM",number:26,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGPROF",number:27,action:"terminate",description:"Timeout or timer",standard:"bsd"},{name:"SIGWINCH",number:28,action:"ignore",description:"Terminal window size changed",standard:"bsd"},{name:"SIGIO",number:29,action:"terminate",description:"I/O is available",standard:"other"},{name:"SIGPOLL",number:29,action:"terminate",description:"Watched event",standard:"other"},{name:"SIGINFO",number:29,action:"ignore",description:"Request for process information",standard:"other"},{name:"SIGPWR",number:30,action:"terminate",description:"Device running out of power",standard:"systemv"},{name:"SIGSYS",number:31,action:"core",description:"Invalid system call",standard:"other"},{name:"SIGUNUSED",number:31,action:"terminate",description:"Invalid system call",standard:"other"}];fe.SIGNALS=tr});var _e=S(j=>{"use strict";Object.defineProperty(j,"__esModule",{value:!0});j.SIGRTMAX=j.getRealtimeSignals=void 0;var nr=function(){let e=cn-an+1;return Array.from({length:e},or)};j.getRealtimeSignals=nr;var or=function(e,t){return{name:`SIGRT${t+1}`,number:an+t,action:"terminate",description:"Application-specific signal (realtime)",standard:"posix"}},an=34,cn=64;j.SIGRTMAX=cn});var ln=S(pe=>{"use strict";Object.defineProperty(pe,"__esModule",{value:!0});pe.getSignals=void 0;var rr=require("os"),sr=sn(),ir=_e(),ar=function(){let e=(0,ir.getRealtimeSignals)();return[...sr.SIGNALS,...e].map(cr)};pe.getSignals=ar;var cr=function({name:e,number:t,description:n,action:o,forced:r=!1,standard:i}){let{signals:{[e]:a}}=rr.constants,d=a!==void 0;return{name:e,number:d?a:t,description:n,supported:d,action:o,forced:r,standard:i}}});var dn=S(K=>{"use strict";Object.defineProperty(K,"__esModule",{value:!0});K.signalsByNumber=K.signalsByName=void 0;var lr=require("os"),un=ln(),ur=_e(),dr=function(){return(0,un.getSignals)().reduce(mr,{})},mr=function(e,{name:t,number:n,description:o,supported:r,action:i,forced:a,standard:d}){return{...e,[t]:{name:t,number:n,description:o,supported:r,action:i,forced:a,standard:d}}},fr=dr();K.signalsByName=fr;var pr=function(){let e=(0,un.getSignals)(),t=ur.SIGRTMAX+1,n=Array.from({length:t},(o,r)=>hr(r,e));return Object.assign({},...n)},hr=function(e,t){let n=yr(e,t);if(n===void 0)return{};let{name:o,description:r,supported:i,action:a,forced:d,standard:p}=n;return{[e]:{name:o,number:e,description:r,supported:i,action:a,forced:d,standard:p}}},yr=function(e,t){let n=t.find(({name:o})=>lr.constants.signals[o]===e);return n!==void 0?n:t.find(o=>o.number===e)},Sr=pr();K.signalsByNumber=Sr});var fn=S((ti,mn)=>{"use strict";var{signalsByName:gr}=dn(),wr=({timedOut:e,timeout:t,errorCode:n,signal:o,signalDescription:r,exitCode:i,isCanceled:a})=>e?`timed out after ${t} milliseconds`:a?"was canceled":n!==void 0?`failed with ${n}`:o!==void 0?`was killed with ${o} (${r})`:i!==void 0?`failed with exit code ${i}`:"failed",xr=({stdout:e,stderr:t,all:n,error:o,signal:r,exitCode:i,command:a,escapedCommand:d,timedOut:p,isCanceled:h,killed:x,parsed:{options:{timeout:g}}})=>{i=i===null?void 0:i,r=r===null?void 0:r;let v=r===void 0?void 0:gr[r].description,b=o&&o.code,E=`Command ${wr({timedOut:p,timeout:g,errorCode:b,signal:r,signalDescription:v,exitCode:i,isCanceled:h})}: ${a}`,A=Object.prototype.toString.call(o)==="[object Error]",l=A?`${E}
${o.message}`:E,c=[l,t,e].filter(Boolean).join(`
`);return A?(o.originalMessage=o.message,o.message=c):o=new Error(c),o.shortMessage=l,o.command=a,o.escapedCommand=d,o.exitCode=i,o.signal=r,o.signalDescription=v,o.stdout=e,o.stderr=t,n!==void 0&&(o.all=n),"bufferedData"in o&&delete o.bufferedData,o.failed=!0,o.timedOut=!!p,o.isCanceled=h,o.killed=x&&!p,o};mn.exports=xr});var hn=S((ni,Me)=>{"use strict";var he=["stdin","stdout","stderr"],br=e=>he.some(t=>e[t]!==void 0),pn=e=>{if(!e)return;let{stdio:t}=e;if(t===void 0)return he.map(o=>e[o]);if(br(e))throw new Error(`It's not possible to provide \`stdio\` in combination with one of ${he.map(o=>`\`${o}\``).join(", ")}`);if(typeof t=="string")return t;if(!Array.isArray(t))throw new TypeError(`Expected \`stdio\` to be of type \`string\` or \`Array\`, got \`${typeof t}\``);let n=Math.max(t.length,he.length);return Array.from({length:n},(o,r)=>t[r])};Me.exports=pn;Me.exports.node=e=>{let t=pn(e);return t==="ipc"?"ipc":t===void 0||typeof t=="string"?[t,t,t,"ipc"]:t.includes("ipc")?t:[...t,"ipc"]}});var yn=S((oi,ye)=>{ye.exports=["SIGABRT","SIGALRM","SIGHUP","SIGINT","SIGTERM"];process.platform!=="win32"&&ye.exports.push("SIGVTALRM","SIGXCPU","SIGXFSZ","SIGUSR2","SIGTRAP","SIGSYS","SIGQUIT","SIGIOT");process.platform==="linux"&&ye.exports.push("SIGIO","SIGPOLL","SIGPWR","SIGSTKFLT","SIGUNUSED")});var bn=S((ri,V)=>{var w=global.process,$=function(e){return e&&typeof e=="object"&&typeof e.removeListener=="function"&&typeof e.emit=="function"&&typeof e.reallyExit=="function"&&typeof e.listeners=="function"&&typeof e.kill=="function"&&typeof e.pid=="number"&&typeof e.on=="function"};$(w)?(Sn=require("assert"),X=yn(),gn=/^win/i.test(w.platform),oe=require("events"),typeof oe!="function"&&(oe=oe.EventEmitter),w.__signal_exit_emitter__?C=w.__signal_exit_emitter__:(C=w.__signal_exit_emitter__=new oe,C.count=0,C.emitted={}),C.infinite||(C.setMaxListeners(1/0),C.infinite=!0),V.exports=function(e,t){if(!$(global.process))return function(){};Sn.equal(typeof e,"function","a callback must be provided for exit handler"),W===!1&&je();var n="exit";t&&t.alwaysLast&&(n="afterexit");var o=function(){C.removeListener(n,e),C.listeners("exit").length===0&&C.listeners("afterexit").length===0&&Se()};return C.on(n,e),o},Se=function(){!W||!$(global.process)||(W=!1,X.forEach(function(t){try{w.removeListener(t,ge[t])}catch{}}),w.emit=we,w.reallyExit=Ke,C.count-=1)},V.exports.unload=Se,L=function(t,n,o){C.emitted[t]||(C.emitted[t]=!0,C.emit(t,n,o))},ge={},X.forEach(function(e){ge[e]=function(){if($(global.process)){var n=w.listeners(e);n.length===C.count&&(Se(),L("exit",null,e),L("afterexit",null,e),gn&&e==="SIGHUP"&&(e="SIGINT"),w.kill(w.pid,e))}}}),V.exports.signals=function(){return X},W=!1,je=function(){W||!$(global.process)||(W=!0,C.count+=1,X=X.filter(function(t){try{return w.on(t,ge[t]),!0}catch{return!1}}),w.emit=xn,w.reallyExit=wn)},V.exports.load=je,Ke=w.reallyExit,wn=function(t){$(global.process)&&(w.exitCode=t||0,L("exit",w.exitCode,null),L("afterexit",w.exitCode,null),Ke.call(w,w.exitCode))},we=w.emit,xn=function(t,n){if(t==="exit"&&$(global.process)){n!==void 0&&(w.exitCode=n);var o=we.apply(this,arguments);return L("exit",w.exitCode,null),L("afterexit",w.exitCode,null),o}else return we.apply(this,arguments)}):V.exports=function(){return function(){}};var Sn,X,gn,oe,C,Se,L,ge,W,je,Ke,wn,we,xn});var vn=S((si,In)=>{"use strict";var Ir=require("os"),vr=bn(),Fr=1e3*5,Er=(e,t="SIGTERM",n={})=>{let o=e(t);return Cr(e,t,n,o),o},Cr=(e,t,n,o)=>{if(!Hr(t,n,o))return;let r=Ar(n),i=setTimeout(()=>{e("SIGKILL")},r);i.unref&&i.unref()},Hr=(e,{forceKillAfterTimeout:t},n)=>Pr(e)&&t!==!1&&n,Pr=e=>e===Ir.constants.signals.SIGTERM||typeof e=="string"&&e.toUpperCase()==="SIGTERM",Ar=({forceKillAfterTimeout:e=!0})=>{if(e===!0)return Fr;if(!Number.isFinite(e)||e<0)throw new TypeError(`Expected the \`forceKillAfterTimeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`);return e},Tr=(e,t)=>{e.kill()&&(t.isCanceled=!0)},Dr=(e,t,n)=>{e.kill(t),n(Object.assign(new Error("Timed out"),{timedOut:!0,signal:t}))},Nr=(e,{timeout:t,killSignal:n="SIGTERM"},o)=>{if(t===0||t===void 0)return o;let r,i=new Promise((d,p)=>{r=setTimeout(()=>{Dr(e,n,p)},t)}),a=o.finally(()=>{clearTimeout(r)});return Promise.race([i,a])},kr=({timeout:e})=>{if(e!==void 0&&(!Number.isFinite(e)||e<0))throw new TypeError(`Expected the \`timeout\` option to be a non-negative integer, got \`${e}\` (${typeof e})`)},Rr=async(e,{cleanup:t,detached:n},o)=>{if(!t||n)return o;let r=vr(()=>{e.kill()});return o.finally(()=>{r()})};In.exports={spawnedKill:Er,spawnedCancel:Tr,setupTimeout:Nr,validateTimeout:kr,setExitHandler:Rr}});var En=S((ii,Fn)=>{"use strict";var D=e=>e!==null&&typeof e=="object"&&typeof e.pipe=="function";D.writable=e=>D(e)&&e.writable!==!1&&typeof e._write=="function"&&typeof e._writableState=="object";D.readable=e=>D(e)&&e.readable!==!1&&typeof e._read=="function"&&typeof e._readableState=="object";D.duplex=e=>D.writable(e)&&D.readable(e);D.transform=e=>D.duplex(e)&&typeof e._transform=="function";Fn.exports=D});var Hn=S((ai,Cn)=>{"use strict";var{PassThrough:Gr}=require("stream");Cn.exports=e=>{e={...e};let{array:t}=e,{encoding:n}=e,o=n==="buffer",r=!1;t?r=!(n||o):n=n||"utf8",o&&(n=null);let i=new Gr({objectMode:r});n&&i.setEncoding(n);let a=0,d=[];return i.on("data",p=>{d.push(p),r?a=d.length:a+=p.length}),i.getBufferedValue=()=>t?d:o?Buffer.concat(d,a):d.join(""),i.getBufferedLength=()=>a,i}});var Pn=S((ci,re)=>{"use strict";var{constants:Or}=require("buffer"),$r=require("stream"),{promisify:Lr}=require("util"),Br=Hn(),qr=Lr($r.pipeline),xe=class extends Error{constructor(){super("maxBuffer exceeded"),this.name="MaxBufferError"}};async function Xe(e,t){if(!e)throw new Error("Expected a stream");t={maxBuffer:1/0,...t};let{maxBuffer:n}=t,o=Br(t);return await new Promise((r,i)=>{let a=d=>{d&&o.getBufferedLength()<=Or.MAX_LENGTH&&(d.bufferedData=o.getBufferedValue()),i(d)};(async()=>{try{await qr(e,o),r()}catch(d){a(d)}})(),o.on("data",()=>{o.getBufferedLength()>n&&a(new xe)})}),o.getBufferedValue()}re.exports=Xe;re.exports.buffer=(e,t)=>Xe(e,{...t,encoding:"buffer"});re.exports.array=(e,t)=>Xe(e,{...t,array:!0});re.exports.MaxBufferError=xe});var Tn=S((li,An)=>{"use strict";var{PassThrough:Ur}=require("stream");An.exports=function(){var e=[],t=new Ur({objectMode:!0});return t.setMaxListeners(0),t.add=n,t.isEmpty=o,t.on("unpipe",r),Array.prototype.slice.call(arguments).forEach(n),t;function n(i){return Array.isArray(i)?(i.forEach(n),this):(e.push(i),i.once("end",r.bind(null,i)),i.once("error",t.emit.bind(t,"error")),i.pipe(t,{end:!1}),this)}function o(){return e.length==0}function r(i){e=e.filter(function(a){return a!==i}),!e.length&&t.readable&&t.end()}}});var Rn=S((ui,kn)=>{"use strict";var Nn=En(),Dn=Pn(),_r=Tn(),Mr=(e,t)=>{t===void 0||e.stdin===void 0||(Nn(t)?t.pipe(e.stdin):e.stdin.end(t))},jr=(e,{all:t})=>{if(!t||!e.stdout&&!e.stderr)return;let n=_r();return e.stdout&&n.add(e.stdout),e.stderr&&n.add(e.stderr),n},We=async(e,t)=>{if(e){e.destroy();try{return await t}catch(n){return n.bufferedData}}},Ve=(e,{encoding:t,buffer:n,maxBuffer:o})=>{if(!(!e||!n))return t?Dn(e,{encoding:t,maxBuffer:o}):Dn.buffer(e,{maxBuffer:o})},Kr=async({stdout:e,stderr:t,all:n},{encoding:o,buffer:r,maxBuffer:i},a)=>{let d=Ve(e,{encoding:o,buffer:r,maxBuffer:i}),p=Ve(t,{encoding:o,buffer:r,maxBuffer:i}),h=Ve(n,{encoding:o,buffer:r,maxBuffer:i*2});try{return await Promise.all([a,d,p,h])}catch(x){return Promise.all([{error:x,signal:x.signal,timedOut:x.timedOut},We(e,d),We(t,p),We(n,h)])}},Xr=({input:e})=>{if(Nn(e))throw new TypeError("The `input` option cannot be a stream in sync mode")};kn.exports={handleInput:Mr,makeAllStream:jr,getSpawnedResult:Kr,validateInputSync:Xr}});var On=S((di,Gn)=>{"use strict";var Wr=(async()=>{})().constructor.prototype,Vr=["then","catch","finally"].map(e=>[e,Reflect.getOwnPropertyDescriptor(Wr,e)]),zr=(e,t)=>{for(let[n,o]of Vr){let r=typeof t=="function"?(...i)=>Reflect.apply(o.value,t(),i):o.value.bind(t);Reflect.defineProperty(e,n,{...o,value:r})}return e},Yr=e=>new Promise((t,n)=>{e.on("exit",(o,r)=>{t({exitCode:o,signal:r})}),e.on("error",o=>{n(o)}),e.stdin&&e.stdin.on("error",o=>{n(o)})});Gn.exports={mergePromise:zr,getSpawnedPromise:Yr}});var Bn=S((mi,Ln)=>{"use strict";var $n=(e,t=[])=>Array.isArray(t)?[e,...t]:[e],Jr=/^[\w.-]+$/,Qr=/"/g,Zr=e=>typeof e!="string"||Jr.test(e)?e:`"${e.replace(Qr,'\\"')}"`,es=(e,t)=>$n(e,t).join(" "),ts=(e,t)=>$n(e,t).map(n=>Zr(n)).join(" "),ns=/ +/g,os=e=>{let t=[];for(let n of e.trim().split(ns)){let o=t[t.length-1];o&&o.endsWith("\\")?t[t.length-1]=`${o.slice(0,-1)} ${n}`:t.push(n)}return t};Ln.exports={joinCommand:es,getEscapedCommand:ts,parseCommand:os}});var Xn=S((fi,z)=>{"use strict";var rs=require("path"),ze=require("child_process"),ss=zt(),is=Jt(),as=en(),cs=rn(),be=fn(),Un=hn(),{spawnedKill:ls,spawnedCancel:us,setupTimeout:ds,validateTimeout:ms,setExitHandler:fs}=vn(),{handleInput:ps,getSpawnedResult:hs,makeAllStream:ys,validateInputSync:Ss}=Rn(),{mergePromise:qn,getSpawnedPromise:gs}=On(),{joinCommand:_n,parseCommand:Mn,getEscapedCommand:jn}=Bn(),ws=1e3*1e3*100,xs=({env:e,extendEnv:t,preferLocal:n,localDir:o,execPath:r})=>{let i=t?{...process.env,...e}:e;return n?as.env({env:i,cwd:o,execPath:r}):i},Kn=(e,t,n={})=>{let o=ss._parse(e,t,n);return e=o.command,t=o.args,n=o.options,n={maxBuffer:ws,buffer:!0,stripFinalNewline:!0,extendEnv:!0,preferLocal:!1,localDir:n.cwd||process.cwd(),execPath:process.execPath,encoding:"utf8",reject:!0,cleanup:!0,all:!1,windowsHide:!0,...n},n.env=xs(n),n.stdio=Un(n),process.platform==="win32"&&rs.basename(e,".exe")==="cmd"&&t.unshift("/q"),{file:e,args:t,options:n,parsed:o}},se=(e,t,n)=>typeof t!="string"&&!Buffer.isBuffer(t)?n===void 0?void 0:"":e.stripFinalNewline?is(t):t,Ie=(e,t,n)=>{let o=Kn(e,t,n),r=_n(e,t),i=jn(e,t);ms(o.options);let a;try{a=ze.spawn(o.file,o.args,o.options)}catch(b){let F=new ze.ChildProcess,E=Promise.reject(be({error:b,stdout:"",stderr:"",all:"",command:r,escapedCommand:i,parsed:o,timedOut:!1,isCanceled:!1,killed:!1}));return qn(F,E)}let d=gs(a),p=ds(a,o.options,d),h=fs(a,o.options,p),x={isCanceled:!1};a.kill=ls.bind(null,a.kill.bind(a)),a.cancel=us.bind(null,a,x);let v=cs(async()=>{let[{error:b,exitCode:F,signal:E,timedOut:A},l,c,y]=await hs(a,o.options,h),f=se(o.options,l),I=se(o.options,c),U=se(o.options,y);if(b||F!==0||E!==null){let rt=be({error:b,exitCode:F,signal:E,stdout:f,stderr:I,all:U,command:r,escapedCommand:i,parsed:o,timedOut:A,isCanceled:x.isCanceled,killed:a.killed});if(!o.options.reject)return rt;throw rt}return{command:r,escapedCommand:i,exitCode:0,stdout:f,stderr:I,all:U,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}});return ps(a,o.options.input),a.all=ys(a,o.options),qn(a,v)};z.exports=Ie;z.exports.sync=(e,t,n)=>{let o=Kn(e,t,n),r=_n(e,t),i=jn(e,t);Ss(o.options);let a;try{a=ze.spawnSync(o.file,o.args,o.options)}catch(h){throw be({error:h,stdout:"",stderr:"",all:"",command:r,escapedCommand:i,parsed:o,timedOut:!1,isCanceled:!1,killed:!1})}let d=se(o.options,a.stdout,a.error),p=se(o.options,a.stderr,a.error);if(a.error||a.status!==0||a.signal!==null){let h=be({stdout:d,stderr:p,error:a.error,signal:a.signal,exitCode:a.status,command:r,escapedCommand:i,parsed:o,timedOut:a.error&&a.error.code==="ETIMEDOUT",isCanceled:!1,killed:a.signal!==null});if(!o.options.reject)return h;throw h}return{command:r,escapedCommand:i,exitCode:0,stdout:d,stderr:p,failed:!1,timedOut:!1,isCanceled:!1,killed:!1}};z.exports.command=(e,t)=>{let[n,...o]=Mn(e);return Ie(n,o,t)};z.exports.commandSync=(e,t)=>{let[n,...o]=Mn(e);return Ie.sync(n,o,t)};z.exports.node=(e,t,n={})=>{t&&!Array.isArray(t)&&typeof t=="object"&&(n=t,t=[]);let o=Un.node(n),r=process.execArgv.filter(d=>!d.startsWith("--inspect")),{nodePath:i=process.execPath,nodeOptions:a=r}=n;return Ie(i,[...a,e,...Array.isArray(t)?t:[]],{...n,stdin:void 0,stdout:void 0,stderr:void 0,stdio:o,shell:!1})}});var Ts={};st(Ts,{default:()=>bo});module.exports=Ho(Ts);var m=require("@raycast/api"),O=require("react");var s=require("@raycast/api");var J="$SystemHostHashKey$",Q="$SystemHostBackupKey$",Z="$HostsCommonKey$",T="/etc/hosts",at="temp_hosts",ee="BackedUp Hosts";var ct="This item is  inactive because the current folder is disabled";var zn=require("@raycast/api"),Yn=k(require("node:crypto")),N=k(require("node:fs")),Ye=k(require("node:os")),Fe=k(require("node:path"));var Wn=k(require("node:process"),1),Vn=k(Xn(),1);async function ve(e){if(Wn.default.platform!=="darwin")throw new Error("macOS only");let{stdout:t}=await(0,Vn.default)("osascript",["-e",e]);return t}var Jn=require("child_process"),Qn=require("node:https");function ie(){let e=N.default.readFileSync(T);return Yn.default.createHash("md5").update(e).digest("hex")}function ae(){return N.default.readFileSync(T,"utf8")}function Zn(e){return N.default.readFileSync(e,"utf8")}function Ee(e){return new Promise((t,n)=>{(0,Qn.get)(e,o=>{let r="";o.on("data",i=>{r+=i}),o.on("end",()=>{t(r)})}).on("error",o=>{n(o)})})}async function eo(e){let t=Fe.default.join(Ye.default.tmpdir(),at);N.default.writeFileSync(t,e,"utf8"),Je()||await Qe(),(0,Jn.execSync)(`cat ${t} > ${T} && rm -rf ${t}`)}function Je(){try{return N.default.accessSync(T,N.default.constants.W_OK),!0}catch{return!1}}async function Qe(){await ve(`do shell script "chmod 777 ${T}" with administrator privileges`)}function ce(e){return e?e.replaceAll("#","\\#").replaceAll(`
`,`

`):""}function to(e){let n=`${bs()}${Fe.default.basename(e.name)}`;return N.default.writeFileSync(n,e.content||"","utf8"),n}function bs(){let e=(0,zn.getPreferenceValues)();if(e.exportLoc){let t=e.exportLoc;return t.endsWith("/")||(t+="/"),no(t),t}return`${Ye.default.homedir()}/Desktop/`}function Is(e){try{return N.default.mkdirSync(e),!0}catch{return!1}}function no(e){try{return!!N.default.statSync(e).isDirectory()}catch{let n=Fe.default.parse(e).dir;return no(n)?Is(e):!1}}var R=require("react");var Ce={};st(Ce,{SelectFile:()=>vs});var oo=k(require("react"),1),ro=require("react");var so=require("@raycast/api"),vs=({onSelect:e,prompt:t="Please select a file",type:n,...o})=>{let r=(0,ro.useCallback)(async()=>{try{let i=await ve(`
        set chosenFile to choose file with prompt "${t}:"${n!=null?`of type {"${n}"}`:""}
        set raycastPath to POSIX path of (path to application "Raycast")
        do shell script "open " & raycastPath
        return POSIX path of chosenFile
      `);e(i||null)}catch{e(null)}},[]);return oo.createElement(so.Action,{...o,onAction:r})};var Fs=require("@raycast/api"),Ze=require("react");var ao=k(require("node:path")),u=require("react/jsx-runtime");function co(){let e=`
  # Hey!\u{1F44B} Welcome to use iHosts \u{1F389}\u{1F389}\u{1F389} 

  You're one step away from using it! Please type \u21A9\uFE0F and allow iHosts to write to the **${T}** file~

  ![](sys-host-prem.png)
  `;return(0,u.jsx)(s.Detail,{markdown:e,actions:(0,u.jsx)(s.ActionPanel,{children:(0,u.jsx)(s.Action,{title:"Get Write Permission",icon:{source:s.Icon.Fingerprint,tintColor:s.Color.Red},onAction:async()=>{try{await Qe(),await(0,s.showHUD)("Write Permission got"),await(0,s.popToRoot)()}catch{await(0,s.showHUD)("Failed to get Write Permission")}}})})})}function lo(e){return(0,u.jsxs)(s.List.Dropdown,{tooltip:"Select Folder",storeValue:!0,onChange:t=>{e.onFolderChange(t)},children:[(0,u.jsx)(s.List.Dropdown.Section,{children:(0,u.jsx)(s.List.Dropdown.Item,{title:"All Hosts",value:"-1"})}),(0,u.jsx)(s.List.Dropdown.Section,{children:e.folders.map(t=>(0,u.jsx)(s.List.Dropdown.Item,{title:t.name,value:t.id,icon:B(t)},t.id))})]})}function B(e,t){if(!e.isFolder)return e.state=="Disabled"?{source:s.Icon.Circle,tintColor:e.folderState==="Disabled"?s.Color.SecondaryText:s.Color.Green}:{source:s.Icon.CheckCircle,tintColor:e.folderState==="Disabled"?s.Color.SecondaryText:s.Color.Green};if(e.isFolder)return t?e.state=="Disabled"?{source:s.Icon.Circle,tintColor:s.Color.Blue}:{source:s.Icon.CheckCircle,tintColor:s.Color.Blue}:e.state=="Disabled"?{source:s.Icon.Folder,tintColor:s.Color.SecondaryText}:{source:s.Icon.Folder,tintColor:s.Color.Blue}}function tt(e){let t=[];return e.isFolder||e.folderState=="Disabled"&&e.state=="Enabled"&&t.push({icon:{source:s.Icon.Info,tintColor:s.Color.SecondaryText},tooltip:ct}),t.push({date:new Date(e.ctime)}),t}function He(e,t,n,o,r,i){return(0,u.jsxs)(s.ActionPanel,{children:[(0,u.jsxs)(s.ActionPanel.Section,{children:[e.name!==ee&&(0,u.jsx)(s.Action,{title:"Toggle State",icon:s.Icon.Repeat,shortcut:{modifiers:[],key:"enter"},onAction:()=>r(e.id)}),(0,u.jsx)(s.Action.Push,{title:"New Host",icon:s.Icon.NewDocument,shortcut:{modifiers:["cmd"],key:"n"},target:(0,u.jsx)(et,{folders:n,upsertHost:o})}),e.name!==ee&&(0,u.jsx)(s.Action.Push,{title:"Edit Host",icon:s.Icon.Pencil,shortcut:{modifiers:["cmd"],key:"e"},target:(0,u.jsx)(et,{folders:n,upsertHost:o,isEdit:!0,host:e})}),(0,u.jsx)(s.Action,{title:"Export Host",icon:s.Icon.Finder,shortcut:{modifiers:["cmd","shift"],key:"e"},onAction:async()=>{await(0,s.showInFinder)(to(e)),(0,s.showHUD)("Host exported")}}),(0,u.jsx)(s.Action,{title:"Delete",icon:s.Icon.Trash,shortcut:{modifiers:["cmd"],key:"delete"},onAction:async()=>{await(0,s.confirmAlert)({icon:s.Icon.Trash,title:"Delete the host?",message:"You will not be able to recover it",primaryAction:{title:"Delete",style:s.Alert.ActionStyle.Destructive}})&&i(e.id)},style:s.Action.Style.Destructive})]}),(0,u.jsx)(mo,{allFolders:n,newFolder:t,toggleFolderState:r,deleteFolder:i})]})}function uo(e,t,n,o,r){return(0,u.jsxs)(s.ActionPanel,{children:[(0,u.jsxs)(s.ActionPanel.Section,{children:[(0,u.jsx)(s.Action.OpenWith,{path:"/etc/hosts"}),(0,u.jsx)(s.Action.Push,{title:"New Host",icon:s.Icon.NewDocument,shortcut:{modifiers:["cmd"],key:"n"},target:(0,u.jsx)(et,{folders:t,upsertHost:n})})]}),(0,u.jsx)(mo,{allFolders:t,newFolder:e,toggleFolderState:o,deleteFolder:r})]})}function mo(e){return(0,u.jsxs)(s.ActionPanel.Section,{children:[(0,u.jsx)(s.Action.Push,{title:"New Folder",icon:s.Icon.NewFolder,shortcut:{modifiers:["cmd","shift"],key:"n"},target:(0,u.jsx)(Cs,{newFolder:e.newFolder})}),(0,u.jsx)(s.ActionPanel.Submenu,{title:"Toggle Folder State",icon:s.Icon.Repeat,shortcut:{modifiers:["cmd","shift"],key:"enter"},children:e.allFolders.map(t=>(0,u.jsx)(s.Action,{title:t.name,icon:B(t,!0),onAction:()=>e.toggleFolderState(t.id)},t.id))}),(0,u.jsx)(s.ActionPanel.Submenu,{title:"Delete Folder",icon:s.Icon.Trash,shortcut:{modifiers:["cmd","shift"],key:"delete"},children:e.allFolders.map(t=>(0,u.jsx)(s.Action,{title:t.name,icon:B(t),onAction:async()=>{await(0,s.confirmAlert)({icon:s.Icon.Trash,title:"Delete the Folder?",message:"The hosts in the folder will also be deleted and you will not be able to recover it",primaryAction:{title:"Delete",style:s.Alert.ActionStyle.Destructive}})&&e.deleteFolder(t.id)}},t.id))})]})}function Cs(e){let[t,n]=(0,R.useState)(),{pop:o}=(0,s.useNavigation)();function r(){t&&t.length>0&&n(void 0)}function i(d){return d?!0:(n("The name should't be empty"),!1)}async function a(d){i(d.name)&&(e.newFolder(d),o())}return(0,u.jsxs)(s.Form,{navigationTitle:"New Folder",actions:(0,u.jsx)(s.ActionPanel,{children:(0,u.jsx)(s.Action.SubmitForm,{title:"New Folder",onSubmit:a})}),children:[(0,u.jsx)(s.Form.TextField,{id:"name",title:"Name",autoFocus:!0,placeholder:"Enter folder name",error:t,onChange:r}),(0,u.jsxs)(s.Form.Dropdown,{id:"mode",title:"Mode",defaultValue:"Multiple",children:[(0,u.jsx)(s.Form.Dropdown.Item,{value:"Multiple",title:"Multiple",icon:s.Icon.Ellipsis}),(0,u.jsx)(s.Form.Dropdown.Item,{value:"Single",title:"Single",icon:s.Icon.Dot})]})]})}function et(e){let[t,n]=(0,R.useState)(e.host?.name||""),[o,r]=(0,R.useState)(""),[i,a]=(0,R.useState)(e.host?.content||""),[d,p]=(0,R.useState)(),[h,x]=(0,R.useState)(!!e.host?.isRemote),[g,v]=(0,R.useState)(e.host?.url||""),[b,F]=(0,R.useState)(),{pop:E}=(0,s.useNavigation)();function A(){d&&d.length>0&&p(void 0)}function l(){b&&b.length>0&&F(void 0)}function c(){return t?!0:(p("The name should't be empty"),!1)}async function y(){c()&&(e.upsertHost({id:e.host?.id,name:t,folder:o,content:i.trim(),url:g}),E())}return(0,u.jsxs)(s.Form,{navigationTitle:e.isEdit?"Edit Host":"New Host",actions:(0,u.jsxs)(s.ActionPanel,{children:[(0,u.jsx)(s.Action.SubmitForm,{title:e.isEdit?"Update Host":"Create Host",icon:e.isEdit?s.Icon.SaveDocument:s.Icon.NewDocument,onSubmit:y}),(0,u.jsx)(Ce.SelectFile,{title:"Import from File",icon:s.Icon.ArrowRight,onSelect:f=>{if(!f)return;let I=ao.default.basename(f);n(I.substring(0,I.lastIndexOf(".")<0?I.length:I.lastIndexOf("."))),a(Zn(f))}})]}),children:[(0,u.jsx)(s.Form.TextField,{id:"name",title:"Name",value:t,autoFocus:!0,placeholder:"Enter host name",error:d,onChange:f=>{n(f),A()}}),(0,u.jsx)(s.Form.Checkbox,{id:"remote",label:"remote",title:"Remote",value:h,onChange:f=>{x(f)}}),h&&(0,u.jsxs)(u.Fragment,{children:[(0,u.jsx)(s.Form.TextField,{id:"hosts_url",title:"URL",value:g,placeholder:"Enter host URL",error:b,onChange:f=>{v(f),l()}}),(0,u.jsx)(s.Form.Description,{text:"Enter the URL to fetch host content"})]}),!e.isEdit&&(0,u.jsxs)(s.Form.Dropdown,{id:"folder",title:"Folder",value:o,onChange:r,children:[(0,u.jsx)(s.Form.Dropdown.Section,{children:(0,u.jsx)(s.Form.Dropdown.Item,{value:"-1",title:"None"})}),(0,u.jsx)(s.Form.Dropdown.Section,{children:e.folders.map(f=>(0,u.jsx)(s.Form.Dropdown.Item,{value:f.id,title:f.name,icon:B(f)},f.id))})]}),(0,u.jsx)(s.Form.TextArea,{id:"content",title:"Content",value:i,placeholder:"Enter host content",onChange:a})]})}var fo=k(require("crypto")),Ae=new Uint8Array(256),Pe=Ae.length;function nt(){return Pe>Ae.length-16&&(fo.default.randomFillSync(Ae),Pe=0),Ae.slice(Pe,Pe+=16)}var po=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;function Hs(e){return typeof e=="string"&&po.test(e)}var ho=Hs;var H=[];for(let e=0;e<256;++e)H.push((e+256).toString(16).substr(1));function Ps(e,t=0){let n=(H[e[t+0]]+H[e[t+1]]+H[e[t+2]]+H[e[t+3]]+"-"+H[e[t+4]]+H[e[t+5]]+"-"+H[e[t+6]]+H[e[t+7]]+"-"+H[e[t+8]]+H[e[t+9]]+"-"+H[e[t+10]]+H[e[t+11]]+H[e[t+12]]+H[e[t+13]]+H[e[t+14]]+H[e[t+15]]).toLowerCase();if(!ho(n))throw TypeError("Stringified UUID is invalid");return n}var yo=Ps;function As(e,t,n){e=e||{};let o=e.random||(e.rng||nt)();if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){n=n||0;for(let r=0;r<16;++r)t[n+r]=o[r];return t}return yo(o)}var q=As;var G=require("@raycast/api");async function So(){let e={id:q(),name:"Origin System Hosts",state:"Enabled",isFolder:!1,isRemote:!1,content:ae(),ctime:new Date().getTime()};await Y([e]);let t=ie();return await G.LocalStorage.setItem(J,t),t}async function go(){let e={id:q(),name:ee,state:"Disabled",isFolder:!1,isRemote:!1,content:ae(),ctime:new Date().getTime()};await G.LocalStorage.setItem(Q,JSON.stringify(e))}async function wo(){await G.LocalStorage.removeItem(Q)}var ot=new G.Cache({capacity:10485760});async function Y(e){let t=JSON.stringify(e),n=Buffer.byteLength(t);n/10485760>1&&(ot=new G.Cache({capacity:10485760*Math.ceil(n/10485760)})),await G.LocalStorage.setItem(Z,t),ot.set(Z,t)}async function xo(){let e=[],t=ot.get(Z)||await G.LocalStorage.getItem(Z);return t&&(e=JSON.parse(t)),e}var P=require("react/jsx-runtime");function bo(){let[e,t]=(0,O.useState)(!1),[n,o]=(0,O.useState)([]),[r,i]=(0,O.useState)([]),[a,d]=(0,O.useState)("-1"),[p,h]=(0,O.useState)();if(!Je())return(0,P.jsx)(co,{});(0,O.useEffect)(()=>{x()},[]);async function x(){if(t(!0),(await m.LocalStorage.getItem(J)||await So())!==ie()){await(0,m.confirmAlert)({icon:{source:m.Icon.ExclamationMark,tintColor:m.Color.Yellow},title:`The file ${T} has been edited by other software!`,message:`You can back up the current ${T} file`,dismissAction:{title:"Overwrite",onAction:async()=>{await g(!0),t(!1)}},primaryAction:{title:"Backup",onAction:async()=>{await go(),await g(!0),t(!1)}}});return}await g(!1),t(!1)}async function g(l){let c=await m.LocalStorage.getItem(Q);h(c?JSON.parse(c):void 0);let y=await xo();if(l){let f=`# iHosts
`;y.forEach(I=>{!I.isFolder&&I.state==="Enabled"&&(f+=`# ${I.name}
 ${I.content}

`),I.isFolder&&I.state==="Enabled"&&I.hosts&&I.hosts.forEach(U=>{U.state==="Enabled"&&(f+=`# ${I.name} - ${U.name}
 ${U.content}

`)})}),await eo(f),await m.LocalStorage.setItem(J,ie())}o(y),i(y.filter(f=>f.isFolder))}function v(l){d(l)}async function b(l){t(!0);try{let c={id:q(),name:l.name,state:"Enabled",mode:l.mode,isFolder:!0,isRemote:!1,folderState:"Enabled",hosts:[],ctime:new Date().getTime()};n.push(c),await Y(n),await g(!1),(0,m.showToast)({title:"Folder created",style:m.Toast.Style.Success})}catch{(0,m.showToast)({title:"Failed to create folder",style:m.Toast.Style.Failure})}finally{t(!1)}}async function F(l){t(!0);try{if(l.id){let c=n.find(y=>!y.isFolder&&y.id===l.id);if(!c){for(let y of n)if(y.isFolder&&(c=y.hosts?.find(f=>f.id===l.id),c))break}if(!c)return;c.name=l.name,c.content=l.content,l.url&&l.url?.match(/^https?:\/\//)&&(c.url=l.url?.toString(),c.isRemote=!!l.url?.length,c.content=await Ee(c.url))}else{let c;if(l.folder!=="-1"&&(c=n.find(f=>f.id===l.folder),!c))return;let y={id:q(),name:l.name,isFolder:!1,isRemote:!!l.url?.length,state:"Enabled",content:l.content,ctime:new Date().getTime(),url:l.url?.toString()};l.url&&l.url?.match(/^https?:\/\//)&&(y.url=l.url?.toString(),y.isRemote=!0,y.content=await Ee(y.url)),c&&c.mode==="Single"&&c.hosts?.find(f=>f.state==="Enabled")&&(y.state="Disabled"),c?(y.folderState=c.state,c.hosts?.push(y)):n.push(y)}await Y(n),await g(!0),(0,m.showToast)({title:"Host created",style:m.Toast.Style.Success})}catch{(0,m.showToast)({title:"Failed to create host",style:m.Toast.Style.Failure})}finally{t(!1)}}async function E(l){if(e){(0,m.showHUD)("Please calm down\u23F3");return}t(!0);try{let c=n.find(f=>f.id===l);if(!c){for(let f of n)if(f.isFolder&&(c=f.hosts?.find(I=>I.id===l),c)){f&&f.mode==="Single"&&c.state==="Disabled"&&f.hosts?.forEach(I=>I.state="Disabled");break}}if(!c)return;let y=c.state==="Enabled"?"Disabled":"Enabled";c.state=y,c.isRemote&&c.url?.match(/https?:\/\//)&&c.state==="Enabled"&&(c.content=await Ee(c.url)),c.isFolder&&(c.folderState=y,c.hosts?.forEach(f=>f.folderState=y)),await Y(n),await g(!(c.isFolder&&c.hosts?.length===0)),(0,m.showToast)({title:"State toggled",style:m.Toast.Style.Success})}catch{(0,m.showToast)({title:"Failed to toggle state",style:m.Toast.Style.Failure})}finally{t(!1)}}async function A(l){t(!0);try{if(p&&p.id===l)await wo(),await g(!1);else{let c=n.filter(y=>y.id!==l);for(let y of c)y.isFolder&&(y.hosts=y.hosts?.filter(f=>f.id!==l));await Y(c),await g(!0)}(0,m.showToast)({title:"Host deleted",style:m.Toast.Style.Success})}catch{(0,m.showToast)({title:"Failed to delete host",style:m.Toast.Style.Failure})}finally{t(!1)}}return(0,P.jsxs)(m.List,{isLoading:e,isShowingDetail:!0,searchBarAccessory:(0,P.jsx)(lo,{folders:r,onFolderChange:v}),children:[(0,P.jsx)(m.List.Item,{title:"System Hosts",icon:{source:m.Icon.ComputerChip,tintColor:m.Color.Blue},detail:(0,P.jsx)(m.List.Item.Detail,{markdown:ce(ae())}),actions:uo(b,r,F,E,A)}),p&&(0,P.jsx)(m.List.Item,{title:p.name,icon:{source:m.Icon.ArrowCounterClockwise,tintColor:m.Color.SecondaryText},accessories:[{date:new Date(p.ctime)}],detail:(0,P.jsx)(m.List.Item.Detail,{markdown:ce(p.content||"")}),actions:He(p,b,r,F,E,A)}),a==="-1"&&n.filter(l=>!l.isFolder).sort((l,c)=>c.ctime-l.ctime).map(l=>(0,P.jsx)(m.List.Item,{title:l.name,icon:B(l),accessories:tt(l),detail:(0,P.jsx)(m.List.Item.Detail,{markdown:ce(l.content||"")}),actions:He(l,b,r,F,E,A)},l.id)),n.filter(l=>a==="-1"&&l.isFolder||a!=="-1"&&l.isFolder&&l.id===a).sort((l,c)=>c.ctime-l.ctime).map(l=>(0,P.jsx)(m.List.Section,{title:l.name,subtitle:`Folder | ${l.mode}`,children:l.hosts?.sort((c,y)=>y.ctime-c.ctime).map(c=>(0,P.jsx)(m.List.Item,{title:c.name,icon:B(c),accessories:tt(c),detail:(0,P.jsx)(m.List.Item.Detail,{markdown:ce(c.content||"")}),actions:He(c,b,r,F,E,A)},c.id))},l.id))]})}
